from svgwrite import Drawing
from svk.visualization.helpers.icons._icons import BarrierIcons
from uuid import uuid4
from pydantic import BaseModel
from abc import ABC, abstractmethod

accent_fill = "#a7a7a7"


class SvgObject(ABC, BaseModel):
    @abstractmethod
    def create(self, dwg: Drawing):
        pass


class Symbol(SvgObject):
    width: float = 300
    height: float = 300
    objects: list[SvgObject] = []

    def create(self, dwg: Drawing):
        icon_symbol = dwg.symbol(id=f"icon_{ uuid4()}", viewBox=f"0 0 {self.width} {self.height}")
        for svg_object in self.objects:
            icon_symbol.add(svg_object.create(dwg))

        return icon_symbol

    def add_to_dwg(self, dwg: Drawing, insert: tuple[float, float], size: tuple[float, float]) -> None:
        icon_symbol = self.create(dwg)
        dwg.defs.add(icon_symbol)
        dwg.add(dwg.use(icon_symbol, insert=insert, size=size))


class Path(SvgObject):
    d: str
    fill: str = "none"
    transform: str | None = None
    stroke_linecap: str = "round"
    stroke_linejoin: str = "round"
    stroke_width: float = 20.0

    def create(self, dwg: Drawing):
        if self.transform is None:
            return dwg.path(
                d=self.d,
                fill=self.fill,
                stroke="black",
                stroke_linecap=self.stroke_linecap,
                stroke_linejoin=self.stroke_linejoin,
                stroke_width=self.stroke_width,
            )
        else:
            return dwg.path(
                d=self.d,
                fill=self.fill,
                stroke="black",
                stroke_linecap=self.stroke_linecap,
                stroke_linejoin=self.stroke_linejoin,
                stroke_width=self.stroke_width,
                transform=self.transform,
            )


class Rect(SvgObject):
    x: float
    y: float
    width: float
    height: float
    stroke: str = "#000000"
    stroke_width: float = 20
    strok_linejoin: str = "round"
    stroke_linecap: str = "round"
    fill: str = "#000000"

    def create(self, dwg: Drawing):
        return dwg.rect(
            insert=(self.x, self.y),
            size=(self.width, self.height),
            fill=self.fill,
            stroke=self.stroke,
            stroke_width=self.stroke_width,
            stroke_linecap=self.stroke_linecap,
            stroke_linejoin=self.strok_linejoin,
        )


def draw_scaled_icon(dwg: Drawing, icon: BarrierIcons, insert: tuple[float, float], size: tuple[float, float] = (24, 24)):
    ico = Symbol()
    match icon:
        case BarrierIcons.MaeslantBarrier:
            ico.objects = [
                Path(d="M 24.170359,196.3714 C 68.915299,121.29763 153.13367,157.57441 153.13367,157.57441"),
                Path(d="M 170.32004,147.49117 C 166.56264,51.164433 240.06307,35.859115 240.06307,35.859115"),
                Path(
                    d="m 46.695954,175.10982 59.056636,84.46477 15.10753,-104.03585 m 59.00465,-36.61713 100.94565,19.22777 -61.80346,-86.181516 m 13.76036,77.088746 -13.39074,-76.567648 m 32.22464,46.150649 -72.10403,19.914429",
                    stroke_width=10,
                ),
                Path(d="M 112.0344,218.59687 48.514185,177.73789 m 32.984057,45.65986 39.485568,-66.61042", stroke_width=10),
            ]
        case BarrierIcons.HaringvlietBarrier:
            ico.objects = [
                Path(d="M 51.638567,218.00261 C 18.139966,185.89907 19.91285,142.81025 19.91285,142.81025"),
                Path(d="m 283.62638,163.97208 c -6.25032,42.98142 -16.43842,55.23733 -16.43842,55.23733"),
                Path(
                    d="m 49.442776,208.75838 76.910984,-71.41731 -98.885556,17.16761 m 251.625456,16.60254 -113.30637,-31.24507 101.63238,75.1942 M 207.69651,110.29944 84.432913,109.95609 M 274.89266,233.67007 37.635997,232.98337",
                    stroke_width=10,
                ),
                Path(
                    d="m 45.322541,84.464738 -29.249338,-50.06664 -29.24934,-50.066643 57.983651,-0.29735 57.983656,-0.29735 -28.734314,50.36399 z",
                    stroke_width=10,
                    fill=accent_fill,
                    transform="matrix(0.75456845,0,0,0.56407441,110.91278,121.99129)",
                ),
            ]
        case BarrierIcons.HartelBarrier:
            ico.objects = [
                Path(
                    d="M 32.719705,119.49805 C 142.37679,26.445768 215.95329,38.323024 259.62374,39.121386 v 88.200944 c -68.85629,51.38753 -147.47737,63.81212 -228.32663,69.7072 z",
                    stroke_width=10,
                    fill=accent_fill,
                ),
                Path(d="M 30.154808,260.33504 V 119.49805"),
                Path(d="M 258.25088,182.1445 V 41.307507"),
                Path(
                    d="m 32.008407,123.76584 c 0,0 75.339703,-3.11429 131.590113,-22.05024 77.1771,-25.980644 93.89133,-57.615128 93.89133,-57.615128"
                ),
                Path(
                    d="m 30.585812,118.78675 c 0,0 37.239771,-41.162762 108.828578,-62.594213 70.33467,-21.056 117.36416,-15.648555 117.36416,-15.648555"
                ),
                Path(
                    d="m 30.588689,194.58625 c 0,0 75.695341,-2.75864 131.945751,-21.69459 77.1771,-25.98065 95.47911,-47.86534 95.47911,-47.86534"
                ),
            ]
        case BarrierIcons.Ramspol:
            ico.objects = [
                Path(d="m 108.51657,222.68539 c -35.403564,-269.85873 267.57095,-92.02657 31.28754,-0.0425", fill=accent_fill),
                Path(d="M 8.2382951,105.06773 116.74205,104.72071", stroke_width=10),
                Path(d="m 226.25716,166.70787 64.74651,0.1839", stroke_width=10),
            ]
        case BarrierIcons.EasternScheldBarrier:
            ico.objects = [
                Rect(
                    x=66.862007,
                    y=180.31404,
                    width=168.57761,
                    height=51.213451,
                    fill=accent_fill,
                    stroke_width=10.0,
                ),
                Rect(
                    x=34.976582,
                    y=120.26601,
                    width=46.28627,
                    height=148.67361,
                    stroke_width=10.0,
                ),
                Rect(
                    x=220.18346,
                    y=120.26601,
                    width=46.28627,
                    height=148.67361,
                    stroke_width=10.0,
                ),
                Path(d="M 45.902124,121.32186 45.546474,56.949401", stroke_width=10.0),
                Path(d="M 71.974039,121.32186 71.618389,56.9494", stroke_width=10.0),
                Path(d="M 231.11045,121.32186 230.7548,56.949399", stroke_width=10.0),
                Path(d="M 257.52939,121.32186 257.17374,56.9494", stroke_width=10.0),
                Path(d="m 64.727389,161.1493 173.202481,-0.0806 v 0", fill=accent_fill),
            ]
        case BarrierIcons.HollandseIJsselBarrier:
            ico.objects = [
                Path(
                    d="M 44.405365,174.76525 196.62312,119.63966 196.97877,71.271404 42.982775,124.61875 Z",
                    stroke_width=10,
                    fill=accent_fill,
                ),
                Path(d="M 40.062225,216.37618 V 75.539194"),
                Path(d="M 196.3172,174.10619 V 33.269194"),
                Path(
                    d="m 101.35995,235.79526 152.21776,-55.12559 0.35565,-48.36826 -153.996003,53.34735 z",
                    stroke_width=10,
                    fill=accent_fill,
                ),
                Path(d="M 97.016813,277.40619 V 136.5692"),
                Path(d="M 253.27179,235.1362 V 94.299203"),
            ]
        case BarrierIcons.All:
            ico.objects = [
                Path(
                    d="m 25.873299,145.86588 q 4.685326,-5.58105 10.197474,-8.26822 5.512148,-2.68717 12.333431,-2.68717 6.545676,0 12.057824,2.48046 5.58105,2.41157 9.715161,6.95909 4.203013,4.47862 6.476774,10.61089 2.273762,6.13226 2.273762,12.81574 0,9.71516 -4.478621,17.63888 -4.409718,7.92371 -12.402333,12.40233 -7.923713,4.40972 -17.983383,4.40972 -11.575512,0 -19.981537,-5.64995 -8.406026,-5.64996 -12.884647,-16.67425 -4.4097182,-11.0932 -4.4097182,-27.07843 0,-13.02245 2.6871722,-23.28883 2.687172,-10.26637 7.717007,-17.01875 5.029836,-6.75239 12.195628,-10.19748 7.165793,-3.445091 16.329739,-3.445091 8.819437,0 15.502917,3.445091 6.752381,3.44509 10.128572,8.54383 3.445092,5.09874 3.445092,9.78406 0,2.82498 -2.135957,5.16764 -2.135957,2.27376 -5.443246,2.27376 -2.893878,0 -5.374345,-1.79144 -2.480466,-1.86035 -3.651798,-5.09874 -1.584742,-4.13411 -5.029835,-6.61458 -3.445093,-2.54937 -7.992615,-2.54937 -3.651798,0 -7.303596,2.13596 -3.582896,2.06706 -6.063363,5.64995 -5.029835,7.3036 -5.925559,26.0449 z m 18.6035,42.78805 q 6.959087,0 11.506609,-5.64995 4.547522,-5.71885 4.547522,-14.9517 0,-6.27007 -2.135957,-10.74869 -2.135958,-4.54752 -5.856658,-6.89019 -3.7207,-2.41156 -8.19932,-2.41156 -4.271915,0 -8.19932,2.27376 -3.858504,2.27376 -6.270069,6.61458 -2.342663,4.27191 -2.342663,10.05967 0,9.30175 4.82313,15.50292 4.823129,6.20116 12.126726,6.20116 z M 145.48693,170.18824 q 0,9.16394 -4.75423,16.46754 -4.68533,7.30359 -13.78037,11.43771 -9.09505,4.13411 -21.56628,4.13411 -14.951703,0 -24.666864,-5.64995 -6.890185,-4.06521 -11.231002,-10.8176 -4.271914,-6.82128 -4.271914,-13.22915 0,-3.7207 2.549368,-6.33897 2.61827,-2.68717 6.614578,-2.68717 3.238387,0 5.443246,2.06705 2.273761,2.06706 3.858504,6.13227 1.929252,4.82313 4.134111,8.06151 2.273761,3.23839 6.33897,5.37435 4.06521,2.06705 10.679783,2.06705 9.09505,0 14.745,-4.20301 5.71885,-4.27191 5.71885,-10.61088 0,-5.02984 -3.10058,-8.13042 -3.03168,-3.16949 -7.92371,-4.82313 -4.82313,-1.65365 -12.95355,-3.514 -10.886493,-2.54937 -18.258991,-5.92556 -7.303596,-3.44509 -11.644413,-9.30175 -4.271915,-5.92556 -4.271915,-14.67609 0,-8.33713 4.547523,-14.8139 4.547522,-6.47677 13.160253,-9.92187 8.612732,-3.51399 20.257143,-3.51399 9.30175,0 16.05413,2.34266 6.82129,2.27376 11.29991,6.13227 4.47862,3.7896 6.54567,7.99261 2.06706,4.20302 2.06706,8.19932 0,3.6518 -2.61827,6.61458 -2.54937,2.89388 -6.40787,2.89388 -3.514,0 -5.37435,-1.72255 -1.79145,-1.79145 -3.9274,-5.78775 -2.75608,-5.71886 -6.61458,-8.88834 -3.85851,-3.23839 -12.40234,-3.23839 -7.923708,0 -12.81574,3.51399 -4.823129,3.4451 -4.823129,8.33713 0,3.03168 1.653644,5.23654 1.653645,2.20486 4.547522,3.7896 2.893878,1.58474 5.856658,2.48047 2.962775,0.89572 9.784065,2.61827 8.54383,1.99815 15.43401,4.40972 6.95909,2.41156 11.78222,5.85665 4.89203,3.4451 7.5792,8.75054 2.75608,5.23654 2.75608,12.88465 z m 5.85666,-58.97999 22.87542,67.73052 22.94432,-68.21283 q 1.79144,-5.37435 2.68717,-7.4414 0.89572,-2.13596 2.96278,-3.789604 2.06705,-1.722546 5.64995,-1.722546 2.61827,0 4.82313,1.309135 2.27376,1.309135 3.51399,3.513995 1.30914,2.13596 1.30914,4.34082 0,1.51584 -0.41341,3.30728 -0.41341,1.72255 -1.03353,3.4451 -0.62012,1.65364 -1.24023,3.44509 l -24.46016,66.00797 q -1.30914,3.78961 -2.61827,7.2347 -1.30914,3.37619 -3.03168,5.99446 -1.72255,2.54937 -4.61643,4.20301 -2.82497,1.65365 -6.95908,1.65365 -4.13411,0 -7.02799,-1.65365 -2.82498,-1.58474 -4.61643,-4.20301 -1.72254,-2.68717 -3.03168,-6.06336 -1.30913,-3.37619 -2.61827,-7.1658 l -24.04674,-65.45676 q -0.62012,-1.79144 -1.30914,-3.51399 -0.62012,-1.72255 -1.10243,-3.7207 -0.41341,-1.99815 -0.41341,-3.37619 0,-3.51399 2.82498,-6.40787 2.82497,-2.89388 7.09689,-2.89388 5.23654,0 7.37249,3.23839 2.20486,3.16948 4.47862,10.19747 z m 76.27436,-1.03353 v 35.41555 l 40.16978,-41.89232 q 2.89388,-3.03168 4.89203,-4.478621 2.06706,-1.446939 5.44325,-1.446939 4.40972,0 7.09689,2.61827 2.75607,2.54937 2.75607,6.27007 0,4.47862 -4.61642,8.88834 l -24.87357,23.56443 28.66317,41.0655 q 3.03168,4.27192 4.54752,7.51031 1.51584,3.16948 1.51584,6.20116 0,3.37619 -2.68717,5.85666 -2.61827,2.48047 -7.16579,2.48047 -4.27192,0 -6.95909,-1.79145 -2.68717,-1.86035 -4.54752,-4.89203 -1.86035,-3.03168 -3.30729,-5.51215 l -24.18455,-37.207 -16.74315,16.05413 v 20.87726 q 0,6.33897 -2.89388,9.43956 -2.89387,3.03168 -7.4414,3.03168 -2.61827,0 -5.02983,-1.37804 -2.41157,-1.37804 -3.7207,-3.7207 -0.96463,-1.92925 -1.17133,-4.47862 -0.20671,-2.54937 -0.20671,-7.3725 v -75.10302 q 0,-6.20116 2.68717,-9.30175 2.75608,-3.10058 7.4414,-3.10058 4.61643,0 7.4414,3.10058 2.89388,3.03168 2.89388,9.30175 z",
                    stroke_width=0,
                    fill="#000000",
                )
            ]
        case _:
            return

    ico.add_to_dwg(dwg=dwg, insert=insert, size=size)
